cmake_minimum_required(VERSION 2.8)
set(INSTALL_PREFIX /usr)
project(whisper-protocol)
set(CMAKE_C_FLAGS "-std=c99")
execute_process(COMMAND ./tools/generate_protobuf)
set(SOURCE "")
set(HEADERS "")
add_subdirectory(src/obj)
add_subdirectory(src/protocol)
include_directories(${PROJECT_INC_DIR}src/obj)
include_directories(${PROJECT_INC_DIR}src/protocol)

execute_process(COMMAND git submodule init)
execute_process(COMMAND git submodule update)
execute_process(COMMAND cmake . -DIGNORE_VERSION=1 WORKING_DIRECTORY jnxlibc)
execute_process(COMMAND make . WORKING_DIRECTORY jnxlibc)
execute_process(COMMAND sudo make install . WORKING_DIRECTORY jnxlibc)
file(MAKE_DIRECTORY whisper_protocol_headers)
file(COPY ${HEADERS} DESTINATION whisper_protocol_headers)

add_definitions("-fPIC")

add_library(whisper-protocol STATIC ${SOURCE})
add_library(whisper-protocols SHARED ${SOURCE})

target_link_libraries(whisper-protocol  ${LINKER_LIBRARIES})
target_link_libraries(whisper-protocols  ${LINKER_LIBRARIES})

install(TARGETS whisper-protocol DESTINATION ${INSTALL_PREFIX}/lib)
install(TARGETS whisper-protocols DESTINATION ${INSTALL_PREFIX}/lib)
install(DIRECTORY whisper_protocol_headers DESTINATION ${INSTALL_PREFIX}/include)
